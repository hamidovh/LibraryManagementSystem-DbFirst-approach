@model IEnumerable<LibraryManagementSystem.DAL.Kateqoriya>

@{
    ViewBag.Title = "Kateqoriyalar";
}

<style>
    .description-cell {
        max-width: 400px;
        white-space: normal !important;
        word-break: break-word;
    }

    .input-group .form-control,
    .input-group .btn {
        height: 38px;
    }

    .form-control:focus,
    button.btn:focus,
    a.btn:focus,
    .form-control:focus-visible,
    button.btn:focus-visible,
    a.btn:focus-visible {
        outline: none !important;
        box-shadow: none !important;
        border-color: inherit !important;
    }

    .input-group:focus-within {
        box-shadow: none !important;
        border-color: inherit !important;
    }

    .btn-spacing {
        margin-left: 8px;
    }

    .scroll-to-top {
        position: fixed;
        bottom: 30px;
        right: 30px;
        display: none;
        width: 40px;
        height: 40px;
        text-align: center;
        color: white;
        background-color: #007bff;
        line-height: 40px;
        border-radius: 50%;
        z-index: 999;
        transition: opacity 0.3s;
    }

    .scroll-to-top:hover {
        background-color: #0056b3;
        text-decoration: none;
        color: white;
    }

    /* Başlıqların dropdown-ları: */
    th.column-dropdown select {
        font-weight: bold;
        color: black;
        background-color: #f1f1f1;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 32px 4px 8px; /* sağdan boşluq verdik ox üçün */
        height: 32px; /* eyni hündürlük */
        line-height: 24px; /* mətn mərkəzləşməsi */
        box-sizing: border-box; /* padding-i daxil etmək üçün */
        /* aşağı ox üçün */
        appearance: none; /* default brauzer oxunu gizlətmək üçün */
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml;utf8,<svg fill='black' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 16px;
    }

    /* KateqoriyaTesviri üçün span: */
    th.special-dropdown span {
        display: inline-block; /* yazının ətrafında qutu */
        padding: 4px 8px; /* iç boşluq */
        border: 1px solid #ccc; /* qutu çərçivəsi */
        border-radius: 4px; /* yumru kənarlar */
        background-color: #f1f1f1; /* qutu fonu */
        font-weight: bold;
        height: 32px; /* eyni hündürlük */
        line-height: 24px; /* mətn mərkəzləşməsi */
        box-sizing: border-box; /* padding-i daxil etmək üçün */
    }
</style>

<h2>Kateqoriyalar</h2>

<div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
    <div>
        @Html.ActionLink("Yeni Kateqoriya Əlavə Et", "CreateKateqoriya", null, new { @class = "btn btn-info" })
    </div>

    @using (Html.BeginForm("IndexKateqoriya", "KateqoriyaIdaresi", FormMethod.Get, new { @class = "form-inline" }))
    {
        <div class="input-group">
            <input type="text" id="searchText" name="searchText" value="@Request.QueryString["searchText"]"
                   class="form-control" placeholder="Axtar (Kateqoriya Adı)" />
            <div class="input-group-append">
                <button type="button" id="btnSearch" class="btn btn-primary btn-spacing">Axtar</button>
                <a href="@Url.Action("IndexKateqoriya")" class="btn btn-secondary">Hamısını Göstər</a>
            </div>
        </div>
    }
</div>

<table class="table table-bordered table-striped table-hover">
    <thead class="thead-light">
        <tr>
            <th class="column-dropdown">
                <!-- Kateqoriya Adı üçün dropdown (sort): -->
                @using (Html.BeginForm("IndexKateqoriya", "KateqoriyaIdaresi", FormMethod.Get))
                {
                    <select id="sortOrder" name="sortOrder" class="column-dropdown">
                        <option value="">Kateqoriya Adı</option>
                        <option value="asc" @(ViewBag.SelectedKateqoriyaAdi == "asc" ? "selected" : "")>A-Z</option>
                        <option value="desc" @(ViewBag.SelectedKateqoriyaAdi == "desc" ? "selected" : "")>Z-A</option>
                    </select>
                    <input type="hidden" name="sortColumn" value="KateqoriyaAdi" />
                    <input type="hidden" name="searchText" value="@Request.QueryString["searchText"]" />
                }
            </th>

            <th class="special-dropdown">
                <span>@Html.DisplayNameFor(m => m.KateqoriyaTesviri)</span>
            </th>
            <th></th>
        </tr>
    </thead>

    <tbody id="kateqoriyaTableBody">
        @Html.Partial("_KateqoriyaPartial", Model)
    </tbody>
</table>

<a href="#" class="scroll-to-top rounded">
    <i class="fas fa-angle-up"></i>
</a>

@if (TempData["SuccessMessage"] != null || TempData["ErrorMessage"] != null)
{
    <div id="feedbackModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header @(TempData["SuccessMessage"] != null ? "bg-success" : "bg-danger") text-white">
                    <h5 class="modal-title">
                        @(TempData["SuccessMessage"] != null ? "Uğur" : "Xəta")
                    </h5>
                </div>
                <div class="modal-body">
                    <p>@(TempData["SuccessMessage"] ?? TempData["ErrorMessage"])</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="modalOkButton" class="btn btn-primary">OK</button>
                </div>
            </div>
        </div>
    </div>
}

@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            // Scroll zamanı oxu göstərir/gizlədir:
            $(window).scroll(function () {
                if ($(this).scrollTop() > 100) {
                    $('.scroll-to-top').fadeIn(300);
                } else {
                    $('.scroll-to-top').fadeOut(300);
                }
            });

            // Bir kliklə yuxarı qayıdır:
            $('.scroll-to-top').click(function (e) {
                e.preventDefault();
                $('html, body').animate({ scrollTop: 0 }, '300');
                return false;
            });

            // Əgər modal üçün TempData varsa, onu göstərir:
            var modalExists = $('#feedbackModal').length > 0;
            if (modalExists) {
                $('#feedbackModal').modal('show');

                $('#modalOkButton').on('click', function () {
                    $('#feedbackModal').modal('hide');
                });
            }
        });

        // AJAX ilə kateqoriyaları yükləyən funksiya:
        function loadKateqoriyalar(searchText, sortColumn, sortOrder) {
            $.get('@Url.Action("KateqoriyaPartial", "KateqoriyaIdaresi")',
                { searchText: searchText, sortColumn: sortColumn, sortOrder: sortOrder },
                function (data) {
                    $("#kateqoriyaTableBody").html(data);
                });
        }

        // Axtarış düyməsi
        $("#btnSearch").on("click", function () {
            var searchText = $("#searchText").val();
            loadKateqoriyalar(searchText, "KateqoriyaAdi", $("#sortOrder").val());
        });

        // Hər düymə basılanda işləyir:
        $("#searchText").on("keyup", function () {
            var searchText = $(this).val();
            loadKateqoriyalar(searchText, "KateqoriyaAdi", $("#sortOrder").val());
        });

        // Sort dəyişəndə
        $("#sortOrder").on("change", function () {
            var sortOrder = $(this).val();
            loadKateqoriyalar($("#searchText").val(), "KateqoriyaAdi", sortOrder);
        });
    </script>
}
